apply plugin: 'java'
sourceCompatibility = 1.5
version = '1.0'

repositories {
    mavenCentral()
}

configurations {
    compile
}

dependencies {
    compile   'org.apache.shiro:shiro-all:1.0.0-incubating' ,
    'com.google.inject:guice:3.0'
}

task copyToLib( dependsOn: 'gui:assemble'){
    copy {
        into "$buildDir/output"
        from configurations.runtime
    }
}

task zip(type: Zip) {
    from "$buildDir/output"
}

build.dependsOn(zip)

task explodedDist(dependsOn: assemble)  {
    project.tasks.withType(Jar).each {archiveTask ->
        copy {
            from archiveTask.archivePath
            into "$buildDir/output"
        }
    }
}

task signJars(type:Exec) {
    workingDir getRootDir().toString() + "/build/output"
    String command = '\"' + System.properties.'java.home' + '/../bin/jarsigner.exe\" -keystore ' + getRootDir().toString() +  '/keystore.p12 -storepass Shark10Byte -storetype pkcs12 ' + getRootDir() + "/build/output/core.jar 1"
    commandLine 'cmd','/c', command
}

build.dependsOn(signJars)

subprojects {
    apply plugin: 'java'
    repositories {
        mavenCentral()
    }
    dependencies {
        compile group: 'junit', name: 'junit', version: '4.11'
    }
    test {
        testLogging {
            events "passed", "skipped", "failed"
        }
    }

    task explodedDist(dependsOn: assemble)  {
        allprojects.each {project ->
            project.tasks.withType(Jar).each {archiveTask ->
                copy {
                    from archiveTask.archivePath
                    into getRootDir().toString() + "/build/output"
                }
            }
        }
    }

}

task wrapper(type: Wrapper) {
    gradleVersion = '1.11'
}


